import numpy as np
import matplotlib.pyplot as plt

def find_stairs(data, threshold):
    steps = []
    current_step = data[0]
    steps.append(current_step)
    
    for value in data[1:]:
        if current_step - value >= threshold:
            current_step = value
            steps.append(current_step)
    
    return steps

# Example data
data = np.array([718.25, 716.9, 716.7754687500001, 717.27, 716.4954794520548, 707.0798305084746, 708.73, 706.2199999999999, 707.0011111111112, 707.73, 715.69, 706.96, 707.05, 707.5150000000001, 706.9, 712.31, 698.82, 693.93, 697.6460869565217, 697.6742857142857, 697.5868333333333, 684.1725806451612, 684.0450000000001, 684.1461627906976, 679.87, 679.8516279069768, 680.37, 679.8733333333333, 673.06, 669.35, 668.5833333333334, 699.4, 696.835, 704.26, 678.16, 684.33, 661.3290566037734, 661.22, 661.35, 661.58, 661.3133333333333, 661.44, 678.5, 651.27, 652.1633333333333, 652.376, 652.1695454545454, 652.1701960784313, 652.1116666666666, 652.1285714285714, 657.0, 652.61, 651.8375, 646.49, 647.17, 647.9533333333334, 646.86, 647.4981889763778, 647.5435294117647, 647.5381818181819, 647.93, 649.35, 647.48, 647.5442857142856, 669.47, 638.3166666666666, 638.6324999999999, 638.4206666666666, 638.105, 638.2314285714285, 638.54, 2022.53, 631.9, 652.45, 653.26, 651.09, 631.93, 631.96, 632.535, 627.2131578947368, 626.99, 627.14296875, 626.9833333333335, 624.76, 625.89, 617.4663636363637, 617.2325, 617.4303703703704, 617.26, 618.01, 616.875, 614.0371428571428, 613.9366666666667, 607.9066666666668, 607.9584, 608.1033333333334, 607.9058333333334, 607.816, 607.9844897959183, 608.34, 607.74, 608.0550000000001, 611.63, 598.2150000000001, 598.2900000000001, 598.73, 630.11, 598.96, 597.78, 598.2875, 599.15, 598.4449999999999, 594.46125, 594.479375, 594.52, 594.36, 594.61, 583.7718181818182, 583.865, 635.35, 623.94, 582.3315789473686, 582.94, 582.2633333333333, 582.3052631578947, 582.3811111111112, 582.3840909090909, 582.3278571428572, 582.3433333333334, 582.4053333333334, 582.3604761904762, 582.4766666666667, 582.4891666666667, 582.5533333333334, 582.4932558139534, 582.5457142857144, 582.28, 582.5415384615385, 582.5748484848485, 582.541923076923, 582.7633333333333, 582.49, 582.478888888889, 582.613137254902, 582.6834177215189, 582.7592307692308, 582.7552173913044, 582.7768421052631, 582.835, 582.7979411764707, 582.8585714285714, 582.782142857143, 582.83, 582.8444444444444, 583.155, 582.6366666666667, 582.7900000000001, 582.74875, 583.19, 582.49, 582.92, 582.7625, 583.02, 582.43, 582.9333333333333, 582.8720000000001, 582.8760869565217, 582.8566666666667, 582.7950000000001, 583.14, 582.8514285714285, 583.66, 582.8, 583.1020000000001, 582.8966666666666, 582.39, 583.3299999999999, 582.9635483870968, 583.075, 582.9000000000001, 583.29, 582.9927272727273, 582.9977777777779, 582.9835, 583.53, 582.51, 583.0171568627451, 
583.46, 583.0176923076923, 582.73, 583.0799999999999, 583.78, 582.4399999999999, 583.165, 583.1433333333333, 583.095, 583.0458823529412, 583.22, 582.81, 582.855, 583.0336363636362, 583.1071428571429, 583.128431372549, 583.1736538461538, 583.1879999999999, 583.17, 583.385, 583.2066666666666, 583.275, 583.2238461538462, 583.2349999999999, 583.29375, 583.2972277227723, 583.314, 583.238, 582.86, 582.85, 583.3208695652174, 583.292, 583.38125, 583.28, 583.3883673469387])

# Define a threshold
threshold = 0.5

# Find stairs
stairs = find_stairs(data, threshold)

# Plotting
plt.figure(figsize=(10, 5))
plt.plot(data, label='Original Data', marker='o')
plt.plot([data.tolist().index(step) for step in stairs], stairs, 'r-', marker='o', label='Detected Stairs')
plt.xlabel('Index')
plt.ylabel('Value')
plt.title('Stair Detection in Noisy Data')
plt.legend()
plt.grid(True)
plt.show()
